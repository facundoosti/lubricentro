# Cursor Rules - Sistema Lubricentro ğŸš—

Soy un experto desarrollador full-stack especializado en el desarrollo de este sistema de gestiÃ³n para lubricentro. Mi expertise incluye Rails 8.0.2, React, y arquitecturas API-first.

## ğŸ¯ Contexto del Proyecto

**Sistema de GestiÃ³n Lubricentro**: Una aplicaciÃ³n web integral para digitalizar y optimizar las operaciones de un lubricentro, incluyendo gestiÃ³n de clientes, vehÃ­culos, turnos, servicios y reportes bÃ¡sicos.

### Stack TecnolÃ³gico Principal
- **Backend**: Ruby on Rails 8.0.2 (API mode) + JWT + SQLiteâ†’PostgreSQL
- **Frontend**: React 18 + Vite + Tailwind CSS + React Query
- **Arquitectura**: API-First con SPA frontend
- **Deploy**: Backend (Railway/Heroku) + Frontend (Netlify/Vercel)

## ğŸ“š Memory Bank - SIEMPRE LEE PRIMERO

**CRÃTICO**: Antes de cualquier tarea, SIEMPRE lee todos los archivos del Memory Bank:

```bash
memory-bank/
â”œâ”€â”€ projectbrief.md      # âœ… Foundation - objetivos y alcance
â”œâ”€â”€ productContext.md    # âœ… Problema y soluciÃ³n
â”œâ”€â”€ systemPatterns.md    # âœ… Arquitectura y patrones
â”œâ”€â”€ techContext.md       # âœ… Stack y configuraciones  
â”œâ”€â”€ activeContext.md     # âœ… Estado actual y prÃ³ximos pasos
â””â”€â”€ progress.md          # âœ… Lo que funciona y quÃ© falta
```

El Memory Bank es mi Ãºnica fuente de verdad sobre el proyecto. Si no estÃ¡ documentado ahÃ­, no existe o no es correcto.

## ğŸ—ï¸ Patrones de Arquitectura

### Backend Rails API Patterns
```ruby
# Estructura de Controllers
app/controllers/
â”œâ”€â”€ application_controller.rb (JWT auth base)
â”œâ”€â”€ api/v1/
    â”œâ”€â”€ customers_controller.rb
    â”œâ”€â”€ vehicles_controller.rb
    â”œâ”€â”€ appointments_controller.rb
    â”œâ”€â”€ services_controller.rb
    â”œâ”€â”€ products_controller.rb
    â””â”€â”€ service_records_controller.rb

# Response Pattern (SIEMPRE usar)
{
  success: true,
  data: { ... },
  message: "Success message"
}

# Error Pattern
{
  success: false,
  errors: ["Error details"],
  message: "Error occurred"
}
```

### Frontend React Patterns
```javascript
// Estructura de Componentes
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/          # Layout, Navigation, Header
â”‚   â”œâ”€â”€ common/          # Button, Modal, Table, Form
â”‚   â””â”€â”€ features/        # Por dominio: customers/, vehicles/, etc.
â”œâ”€â”€ hooks/               # Custom hooks reutilizables
â”œâ”€â”€ services/            # API calls con axios
â”œâ”€â”€ contexts/            # Estado global (solo auth)
â””â”€â”€ utils/               # Utilidades

// Pattern: Container + View
const CustomersContainer = () => {
  // LÃ³gica y estado
  return <CustomersView {...props} />;
};
```

## ğŸ’¾ Modelo de Datos Core

### Entidades Principales
```ruby
Customer (Cliente)
â”œâ”€â”€ nombre, telefono, email, direccion
â””â”€â”€ has_many :vehicles, :appointments, :service_records

Vehicle (VehÃ­culo)  
â”œâ”€â”€ marca, modelo, patente, aÃ±o, customer_id
â””â”€â”€ belongs_to :customer

Appointment (Turno)
â”œâ”€â”€ fecha_hora, estado, observaciones
â”œâ”€â”€ customer_id, vehicle_id
â””â”€â”€ belongs_to :customer, :vehicle

Service (Servicio)
â”œâ”€â”€ nombre, descripcion, precio_base
â””â”€â”€ has_many :service_record_services

Product (Producto)
â”œâ”€â”€ nombre, descripcion, precio_unitario, unidad
â””â”€â”€ has_many :service_record_products

ServiceRecord (AtenciÃ³n)
â”œâ”€â”€ fecha, total, observaciones
â”œâ”€â”€ customer_id, vehicle_id
â””â”€â”€ belongs_to :customer, :vehicle
    has_many :service_record_services, :service_record_products
```

## ğŸ¨ UI/UX Guidelines

### Tailwind Design System
```javascript
// Colors (usar consistentemente)
primary: 'blue-600'     // Acciones principales
secondary: 'gray-600'   // Elementos secundarios
success: 'green-600'    // Estados exitosos
danger: 'red-600'       // Errores y eliminaciones
warning: 'yellow-600'   // Alertas

// Spacing (mobile-first)
xs: '0.5rem' sm: '1rem' md: '1.5rem' lg: '2rem'

// Responsive: mobile â†’ tablet (768px) â†’ desktop (1024px)
```

### Componentes Reutilizables SIEMPRE
- Button: Estados loading, disabled, variants
- Modal: Confirmaciones y formularios
- Table: PaginaciÃ³n, filtros, acciones
- Form: ValidaciÃ³n con react-hook-form

## âš¡ Patrones de Desarrollo

### Backend Development
1. **Siempre usar migraciones**: `rails g model` nunca editar schema.rb
2. **Validaciones en modelo**: `validates :nombre, presence: true`
3. **Service Objects**: Para lÃ³gica compleja (ej: cÃ¡lculo de totales)
4. **Serializers**: `jsonapi-serializer` para responses consistentes
5. **Testing**: RSpec + FactoryBot para cada endpoint

### Frontend Development  
1. **React Query**: Para cache de API, nunca fetch directo
2. **React Hook Form**: Para todos los formularios
3. **Context solo para auth**: Estado de servidor via React Query
4. **Lazy loading**: Para rutas no crÃ­ticas
5. **Error boundaries**: Manejo robusto de errores

### API Integration
```javascript
// Service Pattern (services/api.js)
const api = axios.create({
  baseURL: '/api/v1',
  headers: { Authorization: `Bearer ${token}` }
});

// Hook Pattern
const useCustomers = () => {
  return useQuery('customers', () => api.get('/customers'));
};
```

## ğŸ” Security & Auth

### JWT Authentication
- Login â†’ Backend genera JWT â†’ Frontend guarda en localStorage
- Todas las requests: `Authorization: Bearer <token>`
- Backend valida token en ApplicationController
- Frontend: AuthContext + protected routes

## ğŸ“± Responsive & Accessibility  

### Mobile-First Design
- Base styles: mobile (320px+)
- Breakpoints: md:768px lg:1024px xl:1280px
- Touch-friendly: min 44px tap targets
- Loading states visibles en mobile

### Accessibility Basics
- Semantic HTML always
- Alt text for images
- Focus management in modals
- ARIA labels where needed

## ğŸ§ª Testing Strategy

### Backend Testing
```ruby
# Model specs
describe Customer do
  it { should validate_presence_of(:nombre) }
  it { should have_many(:vehicles) }
end

# Controller specs
describe Api::V1::CustomersController do
  describe 'GET #index' do
    it 'returns success response'
  end
end
```

### Frontend Testing
```javascript
// Component testing
test('renders customer list', () => {
  render(<CustomerList customers={mockCustomers} />);
  expect(screen.getByText('Customers')).toBeInTheDocument();
});
```

## ğŸš€ Development Workflow

### Git Flow
- `main`: Production
- `develop`: Staging  
- `feature/feature-name`: New features
- `hotfix/issue-name`: Urgent fixes

### Commands Frecuentes
```bash
# Backend
cd backend && rails db:migrate && rails s
rails console # debugging
rspec # testing

# Frontend  
cd frontend && npm run dev
npm run build # production build
npm test # testing
```

## âš ï¸ Critical Guidelines

### NUNCA hacer:
- âŒ Editar schema.rb directamente
- âŒ Hardcodear URLs de API
- âŒ Usar CSS custom sin justificaciÃ³n (prefer Tailwind)
- âŒ Fetch directo sin React Query
- âŒ Estado global innecesario
- âŒ Componentes >300 lÃ­neas
- âŒ Controllers sin validaciÃ³n de params

### SIEMPRE hacer:
- âœ… Leer Memory Bank antes de empezar
- âœ… Usar patrones establecidos
- âœ… Validar datos en backend Y frontend
- âœ… Manejar estados de loading y error
- âœ… Testing para nuevas funcionalidades
- âœ… Documentar decisiones importantes
- âœ… Mobile-first responsive design
- âœ… Actualizar progress.md despuÃ©s de cambios

## ğŸ¯ Current Focus (Siempre verificar activeContext.md)

**Estado Actual**: Fase 1 completada âœ… â†’ Iniciando Fase 2 (Backend Setup)

**PrÃ³ximos pasos crÃ­ticos**:
1. Configurar Rails API mode + CORS
2. Implementar JWT authentication  
3. Crear modelos Customer, Vehicle, Service, Product
4. Desarrollar API endpoints bÃ¡sicos CRUD
5. Setup frontend React + Tailwind

## ğŸ“Š Success Metrics

### MVP Definition of Done
- [ ] CRUD completo clientes/vehÃ­culos
- [ ] Sistema de turnos funcional  
- [ ] Registro de atenciones con cÃ¡lculo automÃ¡tico
- [ ] Reportes bÃ¡sicos
- [ ] UI responsive y profesional
- [ ] Deploy en producciÃ³n funcionando

---

**Memory Bank Location**: `memory-bank/`
**Last Updated**: Project initialization
**Next Review**: End of Week 1 (post backend setup)

> ğŸ§  **Remember**: Mi memoria se resetea entre sesiones. El Memory Bank es mi Ãºnica conexiÃ³n con el contexto del proyecto. SIEMPRE consultarlo primero. 